"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{1627:(e,r,t)=>{t.d(r,{Pu:()=>c,fl:()=>o,pB:()=>u,pq:()=>d,qc:()=>h});var a=t(9390),s=t(8516);let n="inviteCodes";function l(){if(!s.db)throw Error("Firestore 未初始化。請確認環境變數已正確設定。");return s.db}async function o(e,r,t){let s=l();try{let l=await i(r);if(l&&"unused"===l.status)throw Error("此 Email 已有未使用的註冊碼");let o=Math.random().toString(36).substring(2,8).toUpperCase(),c="".concat(Date.now(),"_").concat(o),d={id:c,code:o,email:r.toLowerCase().trim(),name:e.trim(),status:"unused",createdAt:(0,a.O5)(),createdBy:t},u=(0,a.H9)(s,n,c);return await (0,a.BN)(u,d),{...d,createdAt:a.Dc.now()}}catch(e){if(console.error("建立註冊碼失敗:",e),e.message.includes("已有未使用"))throw e;throw Error("無法建立註冊碼，請稍後再試")}}async function i(e){let r=l();try{let t=(0,a.P)((0,a.rJ)(r,n),(0,a._M)("email","==",e.toLowerCase().trim())),s=await (0,a.GG)(t);if(s.empty)return null;let l=s.docs.map(e=>e.data());return l.sort((e,r)=>{var t,a;let s=(null==(t=e.createdAt)?void 0:t.toMillis())||0;return((null==(a=r.createdAt)?void 0:a.toMillis())||0)-s}),l[0]}catch(e){return console.error("查詢註冊碼失敗:",e),null}}async function c(e,r){let t=l();try{let s=(0,a.P)((0,a.rJ)(t,n),(0,a._M)("code","==",e.toUpperCase().trim()),(0,a._M)("email","==",r.toLowerCase().trim())),l=await (0,a.GG)(s);if(l.empty)return{valid:!1,error:"註冊碼無效或不符合此 Email"};let o=l.docs[0].data();if("used"===o.status)return{valid:!1,error:"此註冊碼已被使用"};return{valid:!0,inviteCode:o}}catch(e){return console.error("驗證註冊碼失敗:",e),{valid:!1,error:"驗證失敗，請稍後再試"}}}async function d(e){let r=l();try{let t=(0,a.H9)(r,n,e);await (0,a.mZ)(t,{status:"used",usedAt:(0,a.O5)()})}catch(e){throw console.error("更新註冊碼狀態失敗:",e),Error("無法更新註冊碼狀態")}}async function u(){let e=l();try{let r=(0,a.P)((0,a.rJ)(e,n),(0,a.My)("createdAt","desc"));return(await (0,a.GG)(r)).docs.map(e=>e.data())}catch(e){throw console.error("取得註冊碼列表失敗:",e),Error("無法取得註冊碼列表")}}async function h(e){let r=l();try{let t=(0,a.H9)(r,"admins",e);return(await (0,a.x7)(t)).exists()}catch(e){return console.error("檢查 Admin 權限失敗:",e),!1}}},1871:(e,r,t)=>{t.d(r,{A:()=>u});var a=t(5155),s=t(2115),n=t(2619),l=t.n(n),o=t(63),i=t(8826),c=t(8337),d=t(1627);function u(){var e,r,t;let[n,u]=(0,s.useState)(!1),[h,m]=(0,s.useState)(!1),x=(0,o.usePathname)(),{user:p,signOut:f}=(0,i.A)(),{t:g}=(0,c.o)();(0,s.useEffect)(()=>{!async function(){p?m(await (0,d.qc)(p.uid)):m(!1)}()},[p]);let b=[{href:"/dashboard",label:g.sidebar.dashboard,icon:"\uD83D\uDCCA",available:!0},{href:"/content-clone",label:g.sidebar.contentClone,icon:"✨",available:!0},{href:"/customer-lens",label:g.sidebar.customerLens,icon:"\uD83D\uDD0D",available:!0},{href:"/proposal-machine",label:g.sidebar.proposalMachine,icon:"\uD83D\uDCB0",available:!0},{href:"/follow-up",label:g.sidebar.followUp,icon:"\uD83D\uDD04",available:!0}],y=async()=>{try{await f()}catch(e){console.error("登出失敗:",e)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>u(!n),className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md","aria-label":"Toggle menu",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n?(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),n&&(0,a.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black/50 z-30",onClick:()=>u(!1)}),(0,a.jsx)("aside",{className:"\n          fixed top-0 left-0 z-40 h-full w-64 bg-white shadow-lg\n          transform transition-transform duration-300 ease-in-out\n          lg:translate-x-0 lg:static lg:z-auto\n          ".concat(n?"translate-x-0":"-translate-x-full","\n        "),children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-100",children:(0,a.jsxs)(l(),{href:"/dashboard",className:"block",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-blue-600",children:"CLOSER"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Close More, Work Less"})]})}),(0,a.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:(null==p||null==(e=p.displayName)?void 0:e.charAt(0))||(null==p||null==(r=p.email)?void 0:r.charAt(0))||"?"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:(null==p?void 0:p.displayName)||"使用者"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==p?void 0:p.email})]})]})}),(0,a.jsxs)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:[(0,a.jsx)("ul",{className:"space-y-2",children:b.map(e=>{var r;return(0,a.jsx)("li",{children:e.available?(0,a.jsxs)(l(),{href:e.href,onClick:()=>u(!1),className:"\n                        flex items-center gap-3 px-4 py-3 rounded-lg\n                        transition-colors duration-200\n                        ".concat(("/dashboard"===(r=e.href)?"/dashboard"===x:x.startsWith(r))?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n                      "),children:[(0,a.jsx)("span",{className:"text-xl",children:e.icon}),(0,a.jsx)("span",{className:"font-medium",children:e.label})]}):(0,a.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 cursor-not-allowed",children:[(0,a.jsx)("span",{className:"text-xl opacity-50",children:e.icon}),(0,a.jsx)("span",{className:"font-medium",children:e.label}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-1 rounded",children:g.dashboard.comingSoon})]})},e.href)})}),(0,a.jsx)("div",{className:"my-6 border-t border-gray-100"}),(0,a.jsxs)(l(),{href:"/profile",onClick:()=>u(!1),className:"\n                flex items-center gap-3 px-4 py-3 rounded-lg\n                transition-colors duration-200\n                ".concat("/profile"===x?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n              "),children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDC64"}),(0,a.jsx)("span",{className:"font-medium",children:g.sidebar.myProfile})]}),h&&(0,a.jsxs)(l(),{href:"/admin",onClick:()=>u(!1),className:"\n                  flex items-center gap-3 px-4 py-3 rounded-lg mt-2\n                  transition-colors duration-200\n                  ".concat("/admin"===x?"bg-purple-50 text-purple-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n                "),children:[(0,a.jsx)("span",{className:"text-xl",children:"⚙️"}),(0,a.jsx)("span",{className:"font-medium",children:(null==(t=g.admin)?void 0:t.title)||"管理後台"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-100",children:(0,a.jsxs)("button",{onClick:y,className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,a.jsx)("span",{className:"font-medium",children:g.sidebar.logout})]})})]})})]})}},5102:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(5155),s=t(8337);function n(){let{language:e,setLanguage:r,languageNames:t}=(0,s.o)();return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{value:e,onChange:e=>r(e.target.value),className:"appearance-none bg-white border border-gray-200 rounded-lg px-3 py-1.5 pr-8 text-sm text-gray-700 cursor-pointer hover:border-blue-500 focus:outline-none focus:border-blue-500 transition-colors",children:["zh-TW","zh-CN","en","ms","ja","ko"].map(e=>(0,a.jsx)("option",{value:e,children:t[e]},e))}),(0,a.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}},6653:(e,r,t)=>{t.d(r,{A:()=>d});var a=t(5155),s=t(2115),n=t(63),l=t(8826),o=t(8337),i=t(1871),c=t(5102);function d(e){let{children:r}=e,t=(0,n.useRouter)(),{user:d,loading:u}=(0,l.A)(),{t:h}=(0,o.o)();return((0,s.useEffect)(()=>{u||d||t.push("/")},[d,u,t]),u)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:h.common.loading})]})}):d?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,a.jsx)(i.A,{}),(0,a.jsxs)("main",{className:"flex-1 lg:ml-0",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-20",children:(0,a.jsx)("div",{className:"flex items-center justify-end px-6 py-4",children:(0,a.jsx)(c.A,{})})}),(0,a.jsx)("div",{className:"p-6",children:r})]})]}):null}},6908:(e,r,t)=>{t.d(r,{ji:()=>h,ML:()=>p,iH:()=>x,rG:()=>g,Lt:()=>m,H9:()=>f});var a=t(9390),s=t(8516);let n="users",l="profiles",o="main";function i(){if(!s.db)throw Error("Firestore 未初始化。請確認環境變數已正確設定。");return s.db}async function c(e,r){let t=i();try{let s=(0,a.H9)(t,n,e,l,o);(await (0,a.x7)(s)).exists()?await (0,a.mZ)(s,{...r,updatedAt:(0,a.O5)()}):await (0,a.BN)(s,{...r,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)()})}catch(e){throw console.error("儲存 Profile 失敗:",e),Error("無法儲存用戶資料，請稍後再試")}}async function d(e){let r=i();try{let t=(0,a.H9)(r,n,e,l,o),s=await (0,a.x7)(t);if(s.exists())return s.data();return null}catch(e){throw console.error("讀取 Profile 失敗:",e),Error("無法讀取用戶資料，請稍後再試")}}let u="closer_user_profile",h={name:"",industry:"",jobTitle:"",yearsExperience:"",productService:"",productAdvantage:"",priceRange:"",idealCustomer:"",painPoints:[],commonQuestions:["","",""],toneStyle:"",catchphrases:"",avoidWords:"",sampleWriting:"",platforms:[],contentLength:"",cta:"",language:"zh-TW"};function m(e){localStorage.setItem(u,JSON.stringify(e))}function x(){let e=localStorage.getItem(u);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function p(){let e=x();return!!e&&!!(e.name&&e.industry)}async function f(e,r){m(r),await c(e,r)}async function g(e){try{let r=await d(e);if(r)return m(r),r;return x()}catch(e){return console.error("載入雲端 Profile 失敗，使用本地資料:",e),x()}}}}]);