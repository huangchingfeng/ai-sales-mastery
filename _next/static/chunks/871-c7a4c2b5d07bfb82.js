"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{1627:(e,r,a)=>{a.d(r,{KG:()=>m,Pu:()=>i,Se:()=>x,fl:()=>o,pq:()=>c,qc:()=>u});var t=a(9390),l=a(8516);let s="inviteCodes";function n(){if(!l.db)throw Error("Firestore 未初始化。請確認環境變數已正確設定。");return l.db}async function o(e,r,a,l){let o=n();try{let n=await h(r,l);if(n&&"unused"===n.status)throw Error("此 Email 在此課程已有未使用的註冊碼");let i=Math.random().toString(36).substring(2,8).toUpperCase(),c="".concat(Date.now(),"_").concat(i),d={id:c,code:i,email:r.toLowerCase().trim(),name:e.trim(),status:"unused",createdAt:(0,t.O5)(),createdBy:a,...l&&{courseId:l}},u=(0,t.H9)(o,s,c);return await (0,t.BN)(u,d),{...d,createdAt:t.Dc.now()}}catch(e){if(console.error("建立註冊碼失敗:",e),e.message.includes("已有未使用"))throw e;throw Error("無法建立註冊碼，請稍後再試")}}async function i(e,r){let a=n();try{let l=(0,t.P)((0,t.rJ)(a,s),(0,t._M)("code","==",e.toUpperCase().trim()),(0,t._M)("email","==",r.toLowerCase().trim())),n=await (0,t.GG)(l);if(n.empty)return{valid:!1,error:"註冊碼無效或不符合此 Email"};let o=n.docs[0].data();if("used"===o.status)return{valid:!1,error:"此註冊碼已被使用"};return{valid:!0,inviteCode:o}}catch(e){return console.error("驗證註冊碼失敗:",e),{valid:!1,error:"驗證失敗，請稍後再試"}}}async function c(e){let r=n();try{let a=(0,t.H9)(r,s,e);await (0,t.mZ)(a,{status:"used",usedAt:(0,t.O5)()})}catch(e){throw console.error("更新註冊碼狀態失敗:",e),Error("無法更新註冊碼狀態")}}let d=["ai@autolab.cloud"];async function u(e,r){return!!r&&d.includes(r.toLowerCase())}function m(e){return d.includes(e.toLowerCase())}async function h(e,r){let a=n();try{let l;l=r?(0,t.P)((0,t.rJ)(a,s),(0,t._M)("email","==",e.toLowerCase().trim()),(0,t._M)("courseId","==",r)):(0,t.P)((0,t.rJ)(a,s),(0,t._M)("email","==",e.toLowerCase().trim()));let n=await (0,t.GG)(l);if(n.empty)return null;let o=n.docs.map(e=>e.data());return o.sort((e,r)=>{var a,t;let l=(null==(a=e.createdAt)?void 0:a.toMillis())||0;return((null==(t=r.createdAt)?void 0:t.toMillis())||0)-l}),o[0]}catch(e){return console.error("查詢註冊碼失敗:",e),null}}async function x(e){let r=n();try{let a=(0,t.P)((0,t.rJ)(r,s),(0,t._M)("courseId","==",e),(0,t.My)("createdAt","desc"));return(await (0,t.GG)(a)).docs.map(e=>e.data())}catch(e){throw console.error("取得課程學員列表失敗:",e),Error("無法取得課程學員列表")}}},1871:(e,r,a)=>{a.d(r,{A:()=>u});var t=a(5155),l=a(2115),s=a(2619),n=a.n(s),o=a(63),i=a(8826),c=a(8337),d=a(1627);function u(){var e,r,a;let[s,u]=(0,l.useState)(!1),m=(0,o.usePathname)(),{user:h,signOut:x}=(0,i.A)(),{t:p}=(0,c.o)(),f=null!=h&&!!h.email&&(0,d.KG)(h.email),b=[{href:"/dashboard",label:p.sidebar.dashboard,icon:"\uD83D\uDCCA",available:!0},{href:"/content-clone",label:p.sidebar.contentClone,icon:"✨",available:!0},{href:"/customer-lens",label:p.sidebar.customerLens,icon:"\uD83D\uDD0D",available:!0},{href:"/proposal-machine",label:p.sidebar.proposalMachine,icon:"\uD83D\uDCB0",available:!0},{href:"/follow-up",label:p.sidebar.followUp,icon:"\uD83D\uDD04",available:!0}],g=async()=>{try{await x()}catch(e){console.error("登出失敗:",e)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>u(!s),className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md","aria-label":"Toggle menu",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s?(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),s&&(0,t.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black/50 z-30",onClick:()=>u(!1)}),(0,t.jsx)("aside",{className:"\n          fixed top-0 left-0 z-40 h-full w-64 bg-white shadow-lg\n          transform transition-transform duration-300 ease-in-out\n          lg:translate-x-0 lg:static lg:z-auto\n          ".concat(s?"translate-x-0":"-translate-x-full","\n        "),children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-100",children:(0,t.jsxs)(n(),{href:"/dashboard",className:"block",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-blue-600",children:"CLOSER"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Close More, Work Less"})]})}),(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-blue-600 font-medium",children:(null==h||null==(e=h.displayName)?void 0:e.charAt(0))||(null==h||null==(r=h.email)?void 0:r.charAt(0))||"?"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:(null==h?void 0:h.displayName)||"使用者"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==h?void 0:h.email})]})]})}),(0,t.jsxs)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:[(0,t.jsx)("ul",{className:"space-y-2",children:b.map(e=>{var r;return(0,t.jsx)("li",{children:e.available?(0,t.jsxs)(n(),{href:e.href,onClick:()=>u(!1),className:"\n                        flex items-center gap-3 px-4 py-3 rounded-lg\n                        transition-colors duration-200\n                        ".concat(("/dashboard"===(r=e.href)?"/dashboard"===m:m.startsWith(r))?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n                      "),children:[(0,t.jsx)("span",{className:"text-xl",children:e.icon}),(0,t.jsx)("span",{className:"font-medium",children:e.label})]}):(0,t.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 cursor-not-allowed",children:[(0,t.jsx)("span",{className:"text-xl opacity-50",children:e.icon}),(0,t.jsx)("span",{className:"font-medium",children:e.label}),(0,t.jsx)("span",{className:"ml-auto text-xs bg-gray-100 px-2 py-1 rounded",children:p.dashboard.comingSoon})]})},e.href)})}),(0,t.jsx)("div",{className:"my-6 border-t border-gray-100"}),(0,t.jsxs)(n(),{href:"/profile",onClick:()=>u(!1),className:"\n                flex items-center gap-3 px-4 py-3 rounded-lg\n                transition-colors duration-200\n                ".concat("/profile"===m?"bg-blue-50 text-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n              "),children:[(0,t.jsx)("span",{className:"text-xl",children:"\uD83D\uDC64"}),(0,t.jsx)("span",{className:"font-medium",children:p.sidebar.myProfile})]}),f&&(0,t.jsxs)(n(),{href:"/admin",onClick:()=>u(!1),className:"\n                  flex items-center gap-3 px-4 py-3 rounded-lg mt-2\n                  transition-colors duration-200\n                  ".concat("/admin"===m?"bg-purple-50 text-purple-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n                "),children:[(0,t.jsx)("span",{className:"text-xl",children:"⚙️"}),(0,t.jsx)("span",{className:"font-medium",children:(null==(a=p.admin)?void 0:a.title)||"管理後台"})]})]}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-100",children:(0,t.jsxs)("button",{onClick:g,className:"w-full flex items-center justify-center gap-2 px-4 py-3 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,t.jsx)("span",{className:"font-medium",children:p.sidebar.logout})]})})]})})]})}}}]);