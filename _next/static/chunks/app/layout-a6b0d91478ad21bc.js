(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2065:(e,r,t)=>{"use strict";t.d(r,{ProfileProvider:()=>s,x:()=>c});var n=t(5155),o=t(2115),i=t(8826),a=t(6908);let l=(0,o.createContext)(null);function s(e){let{children:r}=e,[t,s]=(0,o.useState)(a.ji),[c,u]=(0,o.useState)(!0),{user:f,loading:d}=(0,i.A)(),h=(0,o.useCallback)(async()=>{if(!d){u(!0);try{let e=null;(e=f?await (0,a.rG)(f.uid):(0,a.iH)())?s(e):s(a.ji)}catch(r){console.error("載入 Profile 失敗:",r);let e=(0,a.iH)();e&&s(e)}finally{u(!1)}}},[f,d]);(0,o.useEffect)(()=>{h()},[h]);let y=(0,o.useCallback)(async e=>{s(e);try{f?await (0,a.H9)(f.uid,e):(0,a.Lt)(e)}catch(r){throw console.error("儲存 Profile 失敗:",r),(0,a.Lt)(e),r}},[f]),w=(0,o.useCallback)(async()=>{await h()},[h]);return(0,n.jsx)(l.Provider,{value:{profile:t,profileLoading:c,updateProfile:y,refreshProfile:w},children:r})}function c(){let e=(0,o.useContext)(l);if(!e)throw Error("useProfile must be used within ProfileProvider");return e}},2996:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,3673,23)),Promise.resolve().then(t.bind(t,8826)),Promise.resolve().then(t.bind(t,2065)),Promise.resolve().then(t.bind(t,8337))},3673:()=>{},6908:(e,r,t)=>{"use strict";t.d(r,{ji:()=>d,ML:()=>w,iH:()=>y,rG:()=>p,Lt:()=>h,H9:()=>m});var n=t(9390),o=t(8516);let i="users",a="profiles",l="main";function s(){if(!o.db)throw Error("Firestore 未初始化。請確認環境變數已正確設定。");return o.db}async function c(e,r){let t=s();try{let o=(0,n.H9)(t,i,e,a,l);(await (0,n.x7)(o)).exists()?await (0,n.mZ)(o,{...r,updatedAt:(0,n.O5)()}):await (0,n.BN)(o,{...r,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()})}catch(e){throw console.error("儲存 Profile 失敗:",e),Error("無法儲存用戶資料，請稍後再試")}}async function u(e){let r=s();try{let t=(0,n.H9)(r,i,e,a,l),o=await (0,n.x7)(t);if(o.exists())return o.data();return null}catch(e){throw console.error("讀取 Profile 失敗:",e),Error("無法讀取用戶資料，請稍後再試")}}let f="closer_user_profile",d={name:"",industry:"",jobTitle:"",yearsExperience:"",productService:"",productAdvantage:"",priceRange:"",idealCustomer:"",painPoints:[],commonQuestions:["","",""],toneStyle:"",catchphrases:"",avoidWords:"",sampleWriting:"",platforms:[],contentLength:"",cta:"",language:"zh-TW"};function h(e){localStorage.setItem(f,JSON.stringify(e))}function y(){let e=localStorage.getItem(f);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function w(){let e=y();return!!e&&!!(e.name&&e.industry)}async function m(e,r){h(r),await c(e,r)}async function p(e){try{let r=await u(e);if(r)return h(r),r;return y()}catch(e){return console.error("載入雲端 Profile 失敗，使用本地資料:",e),y()}}}},e=>{e.O(0,[978,153,563,320,168,441,493,358],()=>e(e.s=2996)),_N_E=e.O()}]);